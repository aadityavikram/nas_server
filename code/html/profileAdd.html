<!DOCTYPE html>
<html>
  <head>
    <title>Add New Profile</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
      html, body {
          height: 100%;
          margin: 0;
          padding: 0;
          font-family: 'Share Tech Mono', monospace;
          background-color: black;
          color: #00ff00;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          text-align: center;
      }
      h2 {
          color: #00ff00;
          text-shadow: 0 0 8px #00ff00;
          margin-bottom: 20px;
          font-size: 2em;
      }
      form {
          border: 1px solid #00ff00;
          padding: 20px 40px;
          border-radius: 8px;
          background-color: rgba(0, 0, 0, 0.8);
          box-shadow: 0 0 20px #00ff00;
          display: flex;
          flex-direction: column;
          gap: 10px;
      }
      input[type="text"] {
          background-color: black;
          border: 1px solid #00ff00;
          color: #00ff00;
          padding: 8px;
          font-family: 'Share Tech Mono', monospace;
          outline: none;
      }
      input[type="text"]:focus {
          box-shadow: 0 0 5px #00ff00;
      }
      input[type="password"] {
          background-color: black;
          border: 1px solid #00ff00;
          color: #00ff00;
          padding: 8px;
          font-family: 'Share Tech Mono', monospace;
          outline: none;
      }
      input[type="password"]:focus {
          box-shadow: 0 0 5px #00ff00;
      }
      input[type="submit"], .back-btn {
          background-color: black;
          border: 1px solid #00ff00;
          color: #00ff00;
          padding: 8px;
          cursor: pointer;
          font-family: 'Share Tech Mono', monospace;
          border-radius: 5px;
          transition: all 0.3s ease;
      }
      input[type="submit"]:hover, .back-btn:hover {
          background-color: #00ff00;
          color: black;
      }
      .error {
          color: red;
          margin-bottom: 10px;
      }
      .back-btn {
          text-decoration: none;
          display: inline-block;
          margin-top: 15px;
          text-align: center;
      }
      .input-wrapper {
          position: relative;
          display: flex;
          align-items: center;
      }
      .input-wrapper input {
          width: 100%;
          padding-right: 60px; /* space for icons */
          box-sizing: border-box;
      }
      .input-wrapper .icon {
          position: absolute;
          right: 10px;
          color: #00ff00;
          cursor: pointer;
          font-size: 0.9em;
          user-select: none;
      }

      /* Separate the icons slightly */
      #caps-icon {
          right: 45px;
          color: #ff3333;
          visibility: hidden;
          pointer-events: none;
      }

      #toggle-icon {
          right: 10px;
      }
    </style>
  </head>
  <body>
    <!-- ERROR MSG PLACEHOLDER -->
    {{error_msg}}
    <h2>Add New Profile</h2>
    <form method="POST" action="/add-profile">
      <label for="profileName">Profile Name:</label>
      <input type="text" id="profileName" name="profileName" required autofocus>
      <label for="profilePassword">Password:</label>

      <div class="input-wrapper">
        <input type="password" id="profilePassword" name="profilePassword">
        <span id="caps-icon" class="icon">C</span>
        <span id="toggle-icon" class="icon">Show</span>
      </div>

      <input type="submit" value="Create Profile">
    </form>
    <a href="/switch" class="back-btn">Back</a>

    <script>
      const passwordField = document.getElementById('profilePassword');
      const capsIcon = document.getElementById('caps-icon');
      const toggleIcon = document.getElementById('toggle-icon');

      // Track Caps Lock state globally
      let capsLockActive = false;

      function updateCapsIndicator(e) {
        capsLockActive = e.getModifierState('CapsLock');
        capsIcon.style.visibility = capsLockActive ? 'visible' : 'hidden';
      }

      passwordField.addEventListener('keydown', updateCapsIndicator);
      passwordField.addEventListener('keyup', updateCapsIndicator);

      // Hide Caps Lock icon when leaving the field
      passwordField.addEventListener('focusout', () => {
        capsIcon.style.visibility = 'hidden';
      });

      // Toggle password visibility
      toggleIcon.addEventListener('click', () => {
        if (passwordField.type === 'password') {
          passwordField.type = 'text';
          toggleIcon.textContent = 'Hide';
        } else {
          passwordField.type = 'password';
          toggleIcon.textContent = 'Show';
        }

        // Restore Caps Lock indicator immediately
        capsIcon.style.visibility = capsLockActive ? 'visible' : 'hidden';
      });
    </script>
  </body>
</html>